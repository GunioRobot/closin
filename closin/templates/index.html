<!doctype html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>DND zgz</title>
		<script type="text/javascript" src="http://www.google.com/jsapi"></script>
		<script type="text/javascript"> google.load("jquery", "1.3.2"); </script>
		<script src="/static/jqt/jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script>
		<style type="text/css" media="screen">@import "/static/jqt/jqtouch/jqtouch.min.css";</style>
		<style type="text/css">
			body {
				-webkit-perspective: 0;
				-webkit-transform-style: flat;
			}
			body > * {
				-webkit-backface-visibility: visible;
			}
			body > .current {
				-webkit-transform: none !important;
			}
		</style>
		<style type="text/css" media="screen">@import "/static/jqt/themes/apple/theme.min.css";</style>
		
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	</head>

	<div id="bus">
		<div class="toolbar">
			<h1>Autobuses</h1>
			<a href="#" class="back">Volver</a>
		</div>
		
		<div id="map-container">
			<!--
			<div id="map-overflow" style="overflow: hidden; width: 320px; height: 415px; text-align: center;">
				<div id="map_canvas" style="width: 360px; height: 445px; margin-left: -20px; margin-top: -20px;"></div>
			</div>
			-->
			<div id="map_canvas" style="width: 360px; height: 445px"></div>
		</div>
	</div>
	
	<div id="home" class="current" style="background:#333">
		<p style="margin-top:20px"><img src="/static/images/cabecera.png" /></p>
		<ul class="rounded"> 
			<li class="arrow"><a class="slide" href="#bus">Autobuses</a></li> 
			<li class="arrow"><a href="#bizi">Bizi</a></li> 
			<li class="arrow"><a href="#farmacias">Farmacias</a></li> 
		</ul> 
		<ul class="rounded"> 
			<li class="arrow"><a href="#ui">Favoritos</a></li> 
		</ul> 
		<ul class="individual"> 
			<li><a href="mailto:dndzgz@gmail.com" target="_blank">Email</a></li>
			<li><a href="#" target="_blank">Equipo</a></li>
		</ul> 
		<div class="info"> 
			<p>¡Añade esta página tu página de inicio!</p> 
		</div> 
	</div>
	
	<script type="text/javascript" charset="utf-8">
	$.jQTouch({
		icon: '/static/images/logo_iphone.png',
		statusBar: 'black-translucent',
		preloadImages: [
			'themes/jqt/img/chevron_white.png',
			'themes/jqt/img/bg_row_select.gif',
			'themes/jqt/img/back_button_clicked.png',
			'themes/jqt/img/button_clicked.png'
			]
		});
		
		var map = null;
		var infowindow = null;
		var markers = [];
		
		function addMarker(lat, lon, name, infowindow) {
			var marker = new google.maps.Marker({
				position: new google.maps.LatLng(lat, lon),
				map: map,
				title: name
			});
			google.maps.event.addListener(marker, 'click', function() {
				infowindow.content = name;
				infowindow.open(map, marker);
			});
			markers.push(marker);
		}
		
			function map_initialize() {
				var latlng = new google.maps.LatLng(41.641184, -0.894032);
				var myOptions = {
					zoom: 12,
					center: latlng,
					navigationControl: false,
					disableDefaultUI: true,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
				infowindow = new google.maps.InfoWindow({
					content: "foobar"
				});
				
				$.ajax({ url: '/fetch?service=bizi',
					dataType: 'json',
					success: function(data) {
						removeMarkers();
						var n = data.length;
						n = 10;
						for(i=0; i<n; i++) {
							var place = data[i];
							addMarker(place['lat'], place['lon'], place['name'], infowindow);
							/*
							var lat = place['lat'];
							var lon = place['lon'];
							var name = place['name'];
							var marker = new google.maps.Marker({
								position: new google.maps.LatLng(lat, lon),
								map: map,
								title: name
							});
							*/
						}
					}
				});
				
			}
			
			function removeMarkers() {
				while(markers.length > 0) {
					markers.pop().setMap(null);
				}
			}
		
		$(document).ready(function() {
			map_initialize();
		});
	</script>
</html>